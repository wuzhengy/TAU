# TAU DHT extention to libtorrent/bittorrent mainline dht (bep 44)
## draft 0.01
The purpose of the extention is to modify Mainline DHT to suitable for blockchain decentralized applications. <br>
The current mainline DHT does not specify the strategy of republish and data schema. In order to operate a decentralized app, the data schema need to be define to represent things like blocks or images. <br>
To optimize seeking of a item, we need better searching protocol to fit massive size of mobile network.  <br>

The global TAU DHT network is viewed as collabortive **"memory"** of the ultimate global computer, storage of each personal devices will exchange data between "memory" and local disk. However, a traverse of all community peers will incur O(N) level complexity, which is not ideal for decentralized apps. Through each peer's knowledge on community state changes, it is possible to reduce traversal complexity towards O(logN) by adding referral public key into data item.  This idea inherits from Dynamic Programming course of MIT 6.006, Prof. Erik Demaine.
<br>
TAU DHT data item is 100K than 1k in libtorrent, which could deal with images.  
<br>

### Schema
Schema is the data existing among the immutable items linked. For example, an image data schema can cross over hundreds of immutable item. The hash of the first block is the root of such data schema. Please check IPLD for the same idea.
Schema could be a blockchain, a multimedia or just a message. 
Different scheme can operate on different level of "memory". Blockchain and messages, the texted based schema, will operate on level ONE, which is BEP 44 protocol. 
### Mutable Item
Mutable item is a pair of key and value. The key follows the format of "publisher's public key + salt". Salt is used to specify the subject of the value. More importantly, in TAU, we view mutable item is a "knowledge pointer", which is a root of the data schema. 
In the case of blockchain, each peer publish its tip block hash through mutable item put. The entire blockchain is a growing data schema using hash link form a chain. In the case of a group chatting, each peer publish its recent message hash. If the content is a picture, the mutable item will be the root of "picture schema". The "root" is similar to IPLD root idea. 
Mutable item generation will allow each peer to present its knowledge to enhance the search efficiency.
While a peer performs self content generation such as proposinig a new block or sending a new message, the value is the key of the immutable item which is put by the same peer. 
While a peer does not generate own, value is a key of immtable hash generated by other peers. The selection of other peers is according to the nature of channel. In chat message, the priority is given to timestamp. For transaction pool, the priority is given to fee amount.
```
More specific definition: 
Mutable item key: publicKey + salt
- Mutable item value: an immutable item key (the hash of a data block, which is the first block of a schema)
```
## Multi-threads
```
[TAU app] <--- single process --> [TAU DHT Engine]   -> frostwire DHT get/put thread1 -> libtorrent put/get
                                                     -> frostwire DHT get/put thread2 -> libtorrent put/get
                                                     -> frostwire DHT get/put thread3 -> libtorrent put/get
```
TAU has 4 thread pools: mutable put, mutable get; immutable put, immutable get. The thread number in each pool starts from 2, and will be changed dynamically according to the response successful rate. The threads are working on a task queue, which is a hash based linked queue providing log(N) level of key uniqueness searching ability. 

## Expiry and pick_least_important to delete strategy
The data hash table will be full sometime. When new items come in, the current libtorrent will pick_least_important item based on the distance and annoucers to erase. This will potentially cause hackers to generate data items and nodes to increase importance and occupy resources. 
The request based data cache strategy will replace this delete strategy with shorter expiry time. Since in the TAU network, data service is request based, the data will not need to stay in cache for too long. In libtorrent, the protocol defines 2 hours as minimum. We will change this to an average blocktime, 5 minutes. This will increase the circulation of the cache. 
